openapi: 3.1.1
info:
  title: Inventory import API
  version: v1.0
paths:

  /inventory-import/channels:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      operationId: getChannels
      description: Get channel config records
      parameters:
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: string
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/channels"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      description: Create channel
      operationId: postChannel
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/channel"
        required: true
      responses:
        "201":
          description: Import channel created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/channel"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
    get:
      operationId: getChannel
      description: Get channel configuration record
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/channel"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putChannel
      description: Update an import channel
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/channel"
        required: true
      responses:
        "200":
          description:  OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteChannel
      description: Delete an import channel
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/upload:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
      - in: query
        name: filename
        required: false
        description: Name of the file to be shown in log statements or failed records. If not provided, a random file name is assigned.
        schema:
          type: string
    post:
      operationId: uploadXmlRecords
      description: Load XML document to given import channel
      requestBody:
        content:
          text/plain:
            schema:
              type: string
        required: true
      responses:
        "200":
          description: Source file uploaded
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/try-transformation:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
      - in: query
        name: output
        required: false
        description: Asks for response in XML or JSON, default is JSON. To view XML, specify ?output=xml
        schema:
          type: string
    post:
      operationId: echoTransformation
      description: Transform XML document synchronously
      requestBody:
        content:
          text/plain:
            schema:
              type: string
        required: true
      responses:
        "200":
          description: Source file processed
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/commission:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
      - in: query
        name: retainQueue
        required: false
        description: If true, Use past file queue if any found in the file system, defaults to false, meaning create new empty queue.
        schema:
          type: string
      - in: query
        name: listening
        required: false
        description: If true, set the channel to actively listen for source files in queue, if false, pause processing. Defaults to true.
        schema:
          type: string
    post:
      operationId: commission
      description: start verticle that listens for incoming source records in given channel
      responses:
        "200":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/decommission:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
      - in: query
        name: retainQueue
        required: false
        description: Keep the existing file queue and source files if any. Defaults to false, meaning delete the queue.
        schema:
          type: string
    post:
      operationId: decommission
      description: stop verticle for given channel ID
      responses:
        "200":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/listen:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
    post:
      operationId: listen
      description: make channel listen for source file when commissioned
      responses:
        "200":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/no-listen:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
    post:
      operationId: noListen
      description: make channel listen for source file when commissioned
      responses:
        "200":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/pause-job:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Import channel identifier
        schema:
          type: string
    post:
      operationId: pauseJob
      description: pause file processing for a job in progress in the given channel
      responses:
        "200":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/resume-job:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
    post:
      operationId: resumeJob
      description: resume file processing for a paused job in the given channel
      responses:
        "200":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/cancel-job:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
    post:
      operationId: cancelJob
      description: Not implemented (cancel a job in progress in the given channel)
      responses:
        "200":
          description: OK
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/channels/{id}/init-queue:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Channel identifier
        schema:
          type: string
    post:
      operationId: initFileSystemQueue
      description: create new file system queue, possibly deleting all sources files in an existing queue for the given channel
      responses:
        "200":
          description: All files deleted from the queue
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/import-jobs:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    post:
      description: Create job log samples for test purposes etc, for example by import from another FOLIO instance.
      operationId: postImportJob
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/importJob"
        required: true
      responses:
        "201":
          description: Job log created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/importJob"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    get:
      operationId: getImportJobs
      description: Retrieves list of import jobs
      parameters:
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: integer
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: integer
        - in: query
          name: from
          required: false
          description: date range start parameter on finished date
          schema:
            type: string
        - in: query
          name: until
          required: false
          description: date range end parameter on finished date
          schema:
            type: string
      responses:
        "200":
          description: List of import jobs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/importJobs"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/import-jobs/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Import job identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getImportJob
      description: Retrieves details of a previous import job
      responses:
        "200":
          description: An import job
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/importJob"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteImportJob
      description: Delete an import job with all its logs
      responses:
        "200":
          description: Job run and logs deleted
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/job-logs:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      operationId: getImportJobLogLines
      description: Retrieves the log of an import job
      parameters:
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: integer
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: integer
        - in: query
          name: from
          required: false
          description: date range start parameter on finished date
          schema:
           type: string
        - in: query
          name: until
          required: false
          description: date range end parameter on finished date
          schema:
            type: string
      responses:
        "200":
          description: Logs for an import job
          content:
            text/plain:
              schema:
                type: string
            application/json:
              schema:
                $ref: "#/components/schemas/logLines"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

    post:
      operationId: postImportJobLogLines
      description: For importing job logs from another source.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/logLines"
        required: true
      responses:
        "201":
          description: Logs imported
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/failed-records:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      operationId: getFailedRecords
      description: Retrieves failed records for import jobs
      parameters:
        - in: query
          name: from
          required: false
          description: date range parameter on error report timestamp
          schema:
            type: string
        - in: query
          name: until
          required: false
          description: date range parameter on error report timestamp
          schema:
            type: string
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: integer
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: integer
      responses:
        "200":
          description: List of failed records for an import job
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/failedRecords"

        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

    post:
      description: Create failed record samples without running a job, for example to import from another FOLIO instance.
      operationId: postFailedRecords
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/failedRecords"
        required: true
      responses:
        "201":
          description: Failed record entries created
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/failed-records/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Failed record identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getFailedRecord
      description: Retrieves a failed record by unique ID
      responses:
        "200":
          description: A report about a record that failed to fully update
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/failedRecord"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

    delete:
      operationId: deleteRecordFailure
      description: Delete a failed record entry
      responses:
        "200":
          description: Record failure deleted
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/steps:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      operationId: getSteps
      description: Get step records
      parameters:
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: string
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/steps"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      description: Create step
      operationId: postStep
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/step"
        required: true
      responses:
        "201":
          description: Step created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/step"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/steps/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Step identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getStep
      description: Get detailed transformation step definition record
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/step"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putStep
      description: Update a transformation step definition
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/step"
      responses:
        "204":
          description: No content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteStep
      description: Delete a transformation step definition
      responses:
        "200":
          description: OK
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/steps/{id}/script:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Step identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getScript
      description: Get transformation step script
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                $ref: "#/components/schemas/script"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putScript
      description: Update a transformation step script
      requestBody:
        content:
          text/plain:
            schema:
              type: string
      responses:
        "204":
          description: OK, no content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/transformations:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      description: Get transformation definitions
      operationId: getTransformations
      parameters:
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: integer
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: integer
      responses:
        "200":
          description: Transformation pipelines returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformations"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      description: Create transformation pipeline
      operationId: postTransformation
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformation"
        required: true
      responses:
        "201":
          description: Transformation pipeline created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformation"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/transformations/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Transformation pipeline identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getTransformation
      description: Get transformation pipeline record
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformation"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putTransformation
      description: Update a transformation pipeline
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformation"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformation"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteTransformation
      description: Delete a transformation pipeline
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/tsas:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      parameters:
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: integer
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: integer
      operationId: getTsas
      description: Get transformation step associations
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociations"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      operationId: postTsa
      description: Create new transformation step association
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformationStepAssociation"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociation"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteTsas
      description: Not implemented (delete all transformation step associations)
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/tsas/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Association identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getTsa
      description: Get a transformation step association by ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociation"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putTsa
      description: Update a transformation step association
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformationStepAssociation"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociation"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteTsa
      description: Delete a transformation step association by ID
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /inventory-import/purge-aged-logs:
    post:
      operationId: purgeAgedLogs
      description: Delete old import job logs from storage
      responses:
        "201":
          description: No content

  /inventory-import/recover-interrupted-channels:
    post:
      operationId: recoverInterruptedChannels
      description: Deploy channels that are 'enabled' but not deployed, as would be the case after a module restart.
      responses:
        "200":
          description: OK

components:
  schemas:
    transformations:
      type: object
      description: Transformation pipeline configuration records
      properties:
        transformations:
          description: List of transformation pipeline definitions
          type: array
          items:
            $ref: "#/components/schemas/transformation"
    transformation:
      type: object
      description: >-
        A transformation pipeline configuration header that steps can be
        assigned to
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the transformation pipeline.
        name:
          type: string
          description: Name of the transformation pipeline.
        description:
          type: string
          description: "Free-text details about the pipeline."
        steps:
          type: array
          description: The transformation steps making up this pipeline, in order of execution.
          items:
            type: object
            description: A transformation step
            properties:
              id:
                type: string
                format: uuid
                description: The ID of the step at this position in the transformation pipeline.
              name:
                type: string
                description: The (unique) name of the step.
            required:
              - id
        metadata:
          $ref: "#/components/schemas/metadata"

    steps:
      description: Collection of transformation step definitions, to be referenced from pipelines.
      type: object
      properties:
        steps:
          type: array
          description: Transformation step definition records
          items:
            $ref: "#/components/schemas/step"
    step:
      description: Transformation step configuration.
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the transformation step.
        name:
          type: string
          description: A name assigned to the transformation step.
        description:
          type: string
          description: >-
            Free text details about the step.
        type:
          type: string
          description: The type of transformation step.
          enum:
            - XmlTransformStep
        script:
          type: string
          description: >-
            The transformation script (XSLT) of the step.
        metadata:
          $ref: "#/components/schemas/metadata"

      required:
        - name
      additionalProperties: true
    script:
      type: object
      description: 'Transformation step script (xslt as plain text)'
      additionalProperties: true
    transformationStepAssociations:
      type: object
      description: Transformation/step associations
      properties:
        transformationSteps:
          type: array
          description: >-
            List of transformation steps associated with transformation pipelines.
          items:
            $ref: "#/components/schemas/transformationStepAssociation"
    transformationStepAssociation:
      type: object
      description: Transformation/step association record.
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the association.
        transformationId:
          type: string
          format: uuid
          description: UUID referencing a transformation pipeline.
        stepId:
           type: string
           format: uuid
           description: UUID referencing a transformation step.
        stepName:
           type: string
           description: optional, read-only name of the step
           readOnly: true
        position:
          type: string
          description: The position of the step amongst other steps in the pipeline.
        metadata:
          $ref: "#/components/schemas/metadata"
      required:
        - stepId
        - transformationId
        - position
      additionalProperties: false
    logLines:
      description: Job log statements as JSON.
      type: object
      properties:
        logLines:
          description: Collection of import log statements.
          type: array
          items:
            $ref: "#/components/schemas/logLine"
    logLine:
      description: A single import log statement from an import job.
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the log line.
        importJobId:
          type: string
          format: uuid
          description: UUID referencing the import job that generated the log.
        channelId:
          type: string
          format: uuid
          description: UUID referencing the channel configuration that governed the import job.
          readOnly: true
        channelName:
          type: string
          description: The name of the channel at the time the job was run.
          readOnly: true
        timeStamp:
          type: string
          description: Date and time the log statement was created.
        jobLabel:
          description: Name of the job that created the log line.
          type: string
        line:
          description: The logged statement.
          type: string
        metadata:
          $ref: "#/components/schemas/metadata"

    failedRecords:
      type: object
      description: Collection of failed-record error reports
      properties:
        failedRecords:
          type: array
          description: Array of failed record reports
          items:
            $ref: "#/components/schemas/failedRecord"
    failedRecord:
      type: object
      description: A report of one or more data failures during import.
      properties:
        id:
          type: string
          format: uuid
          description: Unique ID for the error report.
        importJobId:
          type: string
          format: uuid
          description: UUID referencing the import job generation the report.
        channelId:
          type: string
          format: uuid
          description: UUID referencing the configuration that defined the import job.
          readOnly: true
        channelName:
          type: string
          description: The name of the channel at the time the job was run.
          readOnly: true
        recordNumber:
          type: string
          description: The identifier assigned to this error report by Inventory Import.
        timeStamp:
          type: string
          description: The date and time the error occurred.
        sourceFileName:
          type: string
          description: The name of the uploaded source file containing the error, if filename provider by the uploader.
        recordErrors:
          type: array
          description: List of errors encountered during upsert or delete.
          items:
            type: object
            description: Report of an error encountered during upsert or delete.
            properties:
              error:
                type: object
                description: Details about the error.
                properties:
                  label:
                    type: string
                    description: Short description.
                  typeOfError:
                    type: object
                    description: Error category.
                  typeOfRecord:
                    type: string
                    description: Type of entity affected by the error, i.e. HOLDINGS_RECORD.
                  transaction:
                    type: string
                    description: Type of transaction triggering the error.
                  message:
                    type: object
                    description: Error message produced by the backend component reporting the error.
                  entity:
                    type: object
                    description: The record that was affected by the error.
        originalRecord:
          type: string
          description: The original source record as plain text.
        transformedRecord:
          type: object
          description: The JSON outcome of the transformation of the original record.
        metadata:
          $ref: "#/components/schemas/metadata"

    channels:
      type: object
      description: Collection of channel records.
      properties:
        channels:
          type: array
          description: List of channels.
          items:
            $ref: "#/components/schemas/channel"
    channel:
      type: object
      description: "Configuration of import jobs."
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the configuration.
        name:
          type: string
          description: A name for the configuration.
        tag:
          type: string
          pattern: "^[A-Za-z0-9-_]{1,31}$"
          description: Optional, unique identifier that can be used instead of the UUID in channel operations
        type:
          type: string
          description: Type of import channel, only bulk XML, 'XML', supported.
          enum:
            - XML
        enabled:
          type: boolean
          description: Set to true to indicate that the channel should be deployed for use.
        commissioned:
          type: boolean
          description: Indicates if the channel is actually deployed.
          readOnly: true
        listening:
          type: boolean
          description: Set to true to make an enabled channel actively listen for source files to process.
        transformationId:
          type: string
          format: uuid
          description: UUID referencing the transformation pipeline to use.
        queuedFiles:
          type: integer
          description: Count of source files in the queue. A count of -1 means there is currently no queue in the file system.
          readOnly: true
        fileInProcess:
          type: string
          description: Name of most recent file to be put in process and yet to be completed.
          readOnly: true
        metadata:
          $ref: "#/components/schemas/metadata"
      required:
        - name
        - transformationId

    importJobs:
      type: object
      description: Collection of import job execution records.
      properties:
        importJobs:
          type: array
          description: List of import jobs.
          items:
            $ref: "#/components/schemas/importJob"
    importJob:
      type: object
      description: Report on the execution of an import job.
      properties:
        id:
          type: string
          format: uuid
          description: 'Unique identifier for the import job report.'
        channelName:
          type: string
          description: The name of the channel at the time of logging the import job.
        channelId:
          type: string
          format: uuid
          description: UUID referencing the channel configuration that governed the import job run.
        importType:
          type: string
          description: 'Type of import job (obsolete, always bulk XML).'
        transformation:
          type: string
          description: Then name for the transformation pipeline used for the job.
        status:
          type: string
          description: The intermittent state or final outcome of the job.
          enum:
            - RUNNING
            - PAUSED
            - DONE
        started:
          type: string
          description: Timestamp when the job started.
        finished:
          type: string
          description: Timestamp when the job ended.
        amountImported:
          type: integer
          description: The number of incoming records processed.
        message:
          type: string
          description: A description of the outcome of the import.
        metadata:
          $ref: "#/components/schemas/metadata"

    metadata:
      type: object
      description: For tagging records with current time and user ID on create or update.
      properties:
        createdDate:
          type: string
          description: Time stamp for the records creation.
          readOnly: true
        createdByUserId:
          type: string
          format: uuid
          description: ID of the user creating the record.
          readOnly: true
        updatedDate:
          type: string
          description: Time stamp for the most recent update of the record.
          readOnly: true
        updatedByUserId:
          type: string
          format: uuid
          description: The ID of the user who most recently updated the record.
          readOnly: true


  parameters:
    okapi_tenant:
      in: header
      name: X-Okapi-Tenant
      description: Okapi Tenant
      required: false
      schema:
        type: string
    okapi_token:
      in: header
      name: X-Okapi-Token
      description: Okapi Token
      required: false
      schema:
        type: string
    okapi_url:
      in: header
      name: X-Okapi-Url
      description: Okapi URL
      required: false
      schema:
        type: string
  responses:
    trait_400:
      description: Bad request
      content:
        text/plain:
          schema:
            type: string
        application/json:
          schema:
            type: object
    trait_404:
      description: Bad request
      content:
        text/plain:
          schema:
            type: string
    trait_500:
      description: Internal error
      content:
        text/plain:
          schema:
            type: string
